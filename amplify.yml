version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install -g pnpm@10.4.1
        - pnpm install --frozen-lockfile
    build:
      commands:
        - pnpm run build
        - echo "=== DEBUG: Build completed, checking .next directory ==="
        - ls -la .next/
        - echo "=== DEBUG: Checking standalone directory ==="
        - ls -la .next/standalone/
        - echo "=== DEBUG: Checking .next/standalone/.next directory ==="
        - ls -la .next/standalone/.next/ || echo "No .next directory in standalone"
        - echo "=== DEBUG: Looking for required-server-files.json ==="
        - find .next -name "required-server-files.json" -type f || echo "required-server-files.json not found"
        - echo "=== DEBUG: Ensuring required-server-files.json is in the right place ==="
        - if [ -f .next/required-server-files.json ]; then cp .next/required-server-files.json .next/standalone/required-server-files.json; fi
        - if [ -f .next/standalone/.next/required-server-files.json ]; then cp .next/standalone/.next/required-server-files.json .next/standalone/required-server-files.json; fi
        - echo "=== DEBUG: Copying translation files ==="
        - cp -r data .next/standalone/ || echo "Translation files copy completed"
        - echo "=== DEBUG: Final standalone directory contents ==="
        - ls -la .next/standalone/
  artifacts:
    baseDirectory: .next/standalone
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
